# CVE-2017-1000430

## Metadata

- RustSec: https://rustsec.org/advisories/RUSTSEC-2017-0004.html
- Mitre: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-1000430
- Bug Report GitHub Issue/Release: https://github.com/marshallpierce/rust-base64/issues/28
- Bug Fix GitHub Commit/PR: https://github.com/marshallpierce/rust-base64/commit/24ead980daf11ba563e4fb2516187a56a71ad319

## Source

```rust
pub fn encode_config<T: ?Sized + AsRef<[u8]>>(input: &T, config: Config) -> String {
    let mut buf = String::with_capacity(encoded_size(input.as_ref().len(), config));

    encode_config_buf(input, config, &mut buf);

    buf
}

/// calculate the base64 encoded string size, including padding
fn encoded_size(bytes_len: usize, config: Config) -> usize {
    let rem = bytes_len % 3;

    let complete_input_chunks = bytes_len / 3;
    let complete_output_chars = complete_input_chunks * 4;
    let printing_output_chars = if rem == 0 {
        complete_output_chars
    } else {
        complete_output_chars + 4
    };
    let line_ending_output_chars = match config.line_wrap {
        LineWrap::NoWrap => 0,
        LineWrap::Wrap(n, LineEnding::CRLF) => printing_output_chars / n * 2,
        LineWrap::Wrap(n, LineEnding::LF) => printing_output_chars / n,
    };

    return printing_output_chars + line_ending_output_chars;
}

```

## Description / Analysis

`encoded_size` uses normal operations like `+`, `/`, `%` to calculate the size of the encoded string, which can lead to integer overflow.

## Fixes

use `checked_*` ,which returns `Option<T>`,instead of normal operations.
