# CVE-2020-35878

## Metadata

- RustSec: https://rustsec.org/advisories/RUSTSEC-2020-0022.html
- Mitre: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-35878
- Bug Report GitHub Issue/Release: _
- Bug Fix GitHub Commit/PR: _

## Source

```rust
use std::cmp::Eq;
use std::hash::Hash;
use std::mem;

pub struct Elem<K, V>
where
    K: 'static + Eq + Hash + Sized,
    V: 'static + Sized,
{
    key: K,
    value: V,
    hash: u64,
}

pub struct OccupiedEntry<'a, K: 'static, V: 'static + 'a>
where
    K: 'static + Eq + Hash + Sized,
    V: 'static + Sized,
{
    elem: &'a mut Elem<K, V>,
}

impl<'a, K: 'static, V: 'static + 'a> OccupiedEntry<'a, K, V>
where
    K: 'static + Eq + Hash + Sized,
    V: 'static + Sized,
{
    pub fn remove_entry(self) -> (K, V) {
        let mut key: K = unsafe { mem::uninitialized() };  //here 
        let mut value: V = unsafe { mem::uninitialized() };
        self.elem.hash |= 0x8000000000000000u64;
        mem::swap(&mut key, &mut self.elem.key);
        mem::swap(&mut value, &mut self.elem.value);
        (key, value)
    }
}

fn main() {
    let mut elem = Elem {
        key: "key".to_string(),
        value: "value".to_string(),
        hash: 0u64,
    };
    let occupied_entry = OccupiedEntry { elem: &mut elem };
    println!("{:?}", occupied_entry.remove_entry());
}

```

## Description / Analysis

Use the deprecated `mem::uninitialized()` function to create uninitialized memory.

## Fixes

TODO

## Pattern Description

````rpl
pattern CVE-2020-35878

mvar {
    uninit: span
}

util {
    p_uninitialized = ?pub ?unsafe fn _(_) -> _ {
        let _: _ = unsafe { #span!($uninit, std::mem::uninitialized()) };
    }
}

patt {
    p = & p_uninitialized => Uninit {
        $uninit,
    }
}

diag {
    #[derive(Diagnostic)]
    #[diag(uninit)]
    pub struct Uninit {
        #[primary_span]
        pub uninit: Span,
    }
}

msg {
    uninit = uninitialized memory
}
````