pattern CVE-2022-23639

patt {
    unsound_cast_between_u64_and_atomic_u64 = {
        pub fn _(..) -> _ {
            type AtomicU64 = std::sync::atomic::AtomicU64;

            'src:
            let $src: *mut u64 = _;
            'transmute:
            let $dst: *const AtomicU64 = move $src as *const AtomicU64 (PtrToPtr);
        }
    }
}

diag {
    unsound_cast_between_u64_and_atomic_u64 = {
        primary(transmute) = "it is unsound to cast between `u64` and `AtomicU64`",
        label(transmute)   = "casted here",
        label(src)         = "u64 created here",
        note               = "the alignment of `u64` is smaller than `AtomicU64` on many 32-bits platforms",
        name               = "unsound_cast_between_u64_and_atomic_u64", 
    }
}
