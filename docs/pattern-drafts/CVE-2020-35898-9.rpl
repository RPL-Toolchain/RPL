pattern CVE-2020-35898/9

util {
    p_rc_unsafe_cell() = {
        pub struct $Cell<$T> {
            $inner: Rc<UnsafeCell<$T>>,
        }
        impl<$T> Clone for $Cell<$T> {
            fn clone(&self) -> Self {
                $Cell::#new!{
                    $inner: self.$inner.clone(),
                }
            }
        }
        impl<$T> $Cell<$T> {
            fn $get_mut(&mut self) -> &mut $T {
                @let $res = *self.$inner;
                @let $res = $res.as_ref();
                @let $res = $res.get();
                $res
            }
        }
    }
}

use {
    std::cell::UnsafeCell
    std::rc::Rc
}

patt {
    p = p_rc_unsafe_cell
}




