# CVE-2023-42444

## Metadata

- RustSec: \_
- Mitre: https://www.cve.org/CVERecord?id=CVE-2023-42444
- Bug Report GitHub Issue/Release: https://github.com/whisperfish/rust-phonenumber/security/advisories/GHSA-whhr-7f2w-qqj2
- Bug Fix GitHub Commit/PR: https://github.com/whisperfish/rust-phonenumber/commit/2dd44be94539c051b4dee55d1d9d349bd7bedde6

## Source

```rust
pub fn phone_number(i: &str) -> IResult<&str, Number> {
    parse! { i =>
        opt(tag_no_case("Tel:"));
        let prefix = opt(prefix);
        let national = take_while1(number);
        check;
        let params = opt(parameters);
    };

    Ok((
        i,
        Number {
            national: (*national).into(),

            prefix: prefix
                .or_else(|| {
                    params
                        .as_ref()
                        .and_then(|m| m.get("phone-context"))
                        .map(|&s| if s.as_bytes()[0] == b'+' { &s[1 ..] } else { &s })
                                             //  =^^^ here
                })
                .map(|cs| cs.into()),

            extension: params
                .as_ref()
                .and_then(|m| m.get("ext"))
                .map(|&cs| cs.into()),

            ..Default::default()
        },
    ))
}
```

## Description / Analysis

Out-of-bounds read. In the following case, the `s` string is empty. Using `s.as_bytes()[0]` will panic.

```Rust
#[test]
fn advisory_1() {
    // Just make sure this does not panic.
    let _ = rfc3966::phone_number(".;phone-context=");
}
```

## Fixes

```Rust
s.strip_prefix('+').unwrap_or(s)
```

## Pattern Description

TODO

### References
- https://doc.rust-lang.org/std/string/struct.String.html#method.strip_prefix
