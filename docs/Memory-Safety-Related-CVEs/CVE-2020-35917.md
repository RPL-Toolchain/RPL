````rs
mod ffi {
    /// `ffi::PyObject` is a C struct that represents a Python object.
    struct PyObject {
        ...
    }
}

mod gil {
    /// Register a Python object pointer inside the release pool, to have reference count decreased
    /// next time the GIL is acquired in pyo3.
    ///
    /// If the GIL is held, the reference count will be decreased immediately instead of being queued
    /// for later.
    ///
    /// # Safety
    /// The object must be an owned Python reference.
    pub unsafe fn register_decref(obj: NonNull<ffi::PyObject>) {
        if gil_is_acquired() {
            ffi::Py_DECREF(obj.as_ptr())
        } else {
            POOL.register_decref(obj);
        }
    }
}

/// A Python object with GIL lifetime
///
/// Represents any Python object.  All Python objects can be cast to `PyAny`.
/// In addition, if the inner object is an instance of type `T`, we can downcast
/// `PyAny` into `T`.
#[repr(transparent)]
pub struct PyAny(UnsafeCell<ffi::PyObject>);

/// A Python object of known type T.
#[repr(transparent)]
pub struct Py<T>(NonNull<ffi::PyObject>, PhantomData<T>);

/// Dropping a `Py` instance decrements the reference count on the object by 1.
impl<T> Drop for Py<T> {
    fn drop(&mut self) {
        unsafe {
            gil::register_decref(self.0);
        }
    }
}

/// A commonly-used alias for `Py<PyAny>`.
pub type PyObject = Py<PyAny>;

impl<T> std::convert::From<Py<T>> for PyObject
where
    T: AsRef<PyAny>,
{
    fn from(other: Py<T>) -> Self {
        let Py(ptr, _) = other;
        // `ptr` is copied here, and both `other` and the returned `PyObject` will point to the same object,
        // without changing the reference count.
        Py(ptr, PhantomData)
        // `other` is dropped here, and the reference count is decremented as a result.
    }
}
````
