pattern CVE-2024-27284

patt {
    use std::iter::Iterator;
    use cassandra_cpp_sys::CassIterator;
    use cassandra_cpp_sys::cassandra::case_iterator_next;
    use cassandra_cpp_sys::cassandra::{
        cass_iterator_get_row,
        cass_iterator_get_column,
        cass_iterator_get_value,
        cass_iterator_get_map_key,
        cass_iterator_get_map_value,
        cass_iterator_get_user_type_field_name,
        cass_iterator_get_user_type_field_value,
        cass_iterator_get_keyspace_meta,
        cass_iterator_get_table_meta,
        cass_iterator_get_materialized_view_meta,
        cass_iterator_get_user_type,
        cass_iterator_get_function_meta,
        cass_iterator_get_aggregate_meta,
        cass_iterator_get_column_meta,
        cass_iterator_get_index_meta,
        cass_iterator_get_meta_field_name,
        cass_iterator_get_meta_field_value,
    }
    cassandra_cpp_sys::cassandra::case_bool_t;

    p_incorrect_iterator_impl[
        $Item: ty, 
    ] = impl Iterator for $T {
            fn next(_) -> _ {
                let $mut_iter: *mut CassIterator = _;
                let $next_res: cass_bool_t = case_iterator_next(copy $mut_iter);
                let $discr: u32 = discriminant($next_res);
                switchInt(move $discr) {
                    1 => {
                        let $const_iter: *const CassIterator = move $mut_iter as *const CassIterator;
                        let $item: $Item = #or! {
                            cass_iterator_get_row,
                            cass_iterator_get_column,
                            cass_iterator_get_value,
                            cass_iterator_get_map_key,
                            cass_iterator_get_map_value,
                            cass_iterator_get_user_type_field_name,
                            cass_iterator_get_user_type_field_value,
                            cass_iterator_get_keyspace_meta,
                            cass_iterator_get_table_meta,
                            cass_iterator_get_materialized_view_meta,
                            cass_iterator_get_user_type,
                            cass_iterator_get_function_meta,
                            cass_iterator_get_aggregate_meta,
                            cass_iterator_get_column_meta,
                            cass_iterator_get_index_meta,
                            cass_iterator_get_meta_field_name,
                            cass_iterator_get_meta_field_value,
                        }(move $const_iter);
                    }
                    _ => {
                        // how to express I don't care about the statements in this block?
                    }
                }
            }
        }
}