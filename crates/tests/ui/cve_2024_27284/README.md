# Make cassandra-cpp-sys build 

## on MacOS(arm64) with Homebrew

You may encounter the following error when building cassandra-cpp-sys on MacOS:

```
error: linking with `cc` failed: exit status: 1
  |
  = note:  "cc" "/var/folders/yt/t7lw9htj7lsd1xj08l15hp200000gn/T/rustcVCjqBe/symbols.o" "<88 object files omitted>" "/path/to/project/target/debug/deps/{libui_test-d13ae8f89d4e4308.rlib,liblevenshtein-830104947247a74d.rlib,libcomma-ff4136302c300de3.rlib,librustfix-f3ca00de5e7ba1be.rlib,librustc_version-e74ea6f376ac3c65.rlib,libanyhow-d956ed93660e21da.rlib,libindicatif-80ee5a3baf759d85.rlib,libportable_atomic-c597a60ca228bf42.rlib,libnumber_prefix-d22e30e144557e1d.rlib,libconsole-04ed324f82f510c2.rlib,libunicode_width-77d9a1cc37ca9d85.rlib,libannotate_snippets-72087a4d28d09665.rlib,libanstyle-2801f3416122605f.rlib,libprettydiff-5cba00e2aaeba7d5.rlib,libpad-0954f370e3cc3478.rlib,libunicode_width-4b18edc1f6c2815a.rlib,libansi_term-e2b60119e0afcbcf.rlib,libcolored-6a9ae83d7070b88e.rlib,libcargo_metadata-6e9c5ee955935deb.rlib,libthiserror-ab266e80bb8e9d7e.rlib,libcargo_platform-ade42d7c6988e7da.rlib,libsemver-a52fbfb3c5f18313.rlib,libcamino-ddd690529c388009.rlib,libcrossbeam_channel-634ecabd94762111.rlib,libcrossbeam_utils-e64ff487f22164ba.rlib,libspanned-fef87ba6ce01cb92.rlib,libbstr-aa9d73fd739c2314.rlib,libregex-3353a777551b551b.rlib,libregex_automata-3fad4941ac88d0a7.rlib,libaho_corasick-797a7123645d3bd3.rlib,libregex_syntax-5b50273d38d2cb74.rlib,libcolor_eyre-051a00508449d328.rlib,libcolor_spantrace-9a0fceedcb6db3d3.rlib,libtracing_error-bca0d14ea5aa0986.rlib,libtracing_subscriber-bc2d299e559e6b59.rlib,libthread_local-9b1c1c6627b4154f.rlib,libsharded_slab-372f6010f9e93687.rlib,liblazy_static-139fb29c3c926529.rlib,libtracing-5e407594a804ea7d.rlib,libtracing_core-caa88234d2b2ee2a.rlib,libowo_colors-60da0ca697c24416.rlib,libeyre-55214772aafbd468.rlib,libindenter-ef28380e726c77ea.rlib,libonce_cell-4dbd955bdbdeda7c.rlib,libbacktrace-6e11f1e5fc17ae57.rlib,libobject-97b2fe510dfff379.rlib,libaddr2line-f0f4e0c36f79b027.rlib,libgimli-f70b47a39d9feee0.rlib,librustc_demangle-f8703c2830c3faab.rlib,libcassandra_cpp_sys-4746cfd8503eb275.rlib,libtokio_util-d50eda5d9e8cc5cf.rlib,liblog-397d6309f51e1eb2.rlib,libtokio-ef3b2ecc349edd94.rlib,libpin_project_lite-55f63e3512f4cb90.rlib,libbytes-2274db2ef008682e.rlib,libtokio-de7bfd71514a9eb3.rlib,libsyn-1c71027315f85ddb.rlib,libserde_json-ada72154d94f3dab.rlib,libitoa-8420455d7bc12a60.rlib,libryu-c733779333b037ae.rlib,libserde-4a4568004b92fe85.rlib,libscoped_threadpool-de4b6d7b747616fd.rlib,libquote-d05315e12ae2e88d.rlib,libproc_macro2-e51da544821e805e.rlib,libunicode_ident-2a3d4b52cc490b0f.rlib}.rlib" "<sysroot>/lib/rustlib/aarch64-apple-darwin/lib/{libproc_macro-*}.rlib" "/path/to/project/target/debug/deps/{libpin_project-0d6a7677ee8c9e25.rlib,libparking_lot-4e6d3fbb32052bc1.rlib,libparking_lot_core-e216fe39a5c02e54.rlib,libcfg_if-68bce11cb7551861.rlib,libsmallvec-a12deeff379a8c3a.rlib,liblock_api-32a6e596e8be5aeb.rlib,libscopeguard-6273973f67b334b3.rlib,libnum_rational-0c10c87e15a104da.rlib,libnum_bigint-7ac0a072f34fc217.rlib,libnum_integer-34119a20719d450d.rlib,libnum_traits-5f4c0000422db175.rlib,libmemmap-a7339b44b58b2670.rlib,liblibc-a9cb137f460be172.rlib,libitertools-a03fdf6347f5ccca.rlib,libeither-34f6290d153196ba.rlib,libif_chain-6ff7af407f4629b2.rlib,libfutures-d5bd983df9e546cd.rlib,libfutures_executor-bb0c803509cc566a.rlib,libfutures_util-ece8ac9bca2b9c02.rlib,libmemchr-0a54dde04ccaa13a.rlib,libfutures_io-e1c4e2ea2b78d0f7.rlib,libslab-6a5c4da418d527c4.rlib,libfutures_channel-52d0c06f82e8ccbf.rlib,libpin_project_lite-fcda878e547e63f8.rlib,libfutures_sink-44784625f96ab900.rlib,libfutures_task-21e36602a6e21a82.rlib,libpin_utils-4c987bd32191dc15.rlib,libfutures_core-0f28d841de4d6027.rlib,libbytes-3fc1c2a62e52fb9b.rlib,libbyte_slice_cast-972b1c3507104c4f.rlib}.rlib" "<sysroot>/lib/rustlib/aarch64-apple-darwin/lib/{libstd-*,libpanic_unwind-*,libobject-*,libmemchr-*,libaddr2line-*,libgimli-*,librustc_demangle-*,libstd_detect-*,libhashbrown-*,librustc_std_workspace_alloc-*,libminiz_oxide-*,libadler2-*,libunwind-*,libcfg_if-*,liblibc-*,liballoc-*,librustc_std_workspace_core-*,libcore-*,libcompiler_builtins-*}.rlib" "-lcassandra" "-lcrypto" "-lssl" "-lc++" "-luv" "-liconv" "-lSystem" "-lc" "-lm" "-arch" "arm64" "-mmacosx-version-min=11.0.0" "-L" "/usr/lib/x86_64-linux-gnu" "-L" "/usr/local/lib/x86_64-linux-gnu" "-L" "/usr/local/lib64" "-L" "/usr/local/lib" "-L" "/usr/lib64/" "-L" "/usr/lib/" "-L" "/usr/local/opt/openssl/lib" "-o" "/path/to/project/target/debug/deps/compile_test-41a0093bb2103453" "-Wl,-dead_strip" "-nodefaultlibs"
  = note: some arguments are omitted. use `--verbose` to show all linker arguments
  = note: ld: warning: search path '/usr/lib/x86_64-linux-gnu' not found
          ld: warning: search path '/usr/local/lib/x86_64-linux-gnu' not found
          ld: warning: search path '/usr/local/lib64' not found
          ld: warning: search path '/usr/lib64/' not found
          ld: warning: search path '/usr/local/opt/openssl/lib' not found
          ld: library 'cassandra' not found
          clang: error: linker command failed with exit code 1 (use -v to see invocation)
```

One possible solution:

1. Run `brew install cassandra-cpp-driver` to install the Cassandra C++ driver.
2. Run `find /opt -name "libcassandra.*" 2>/dev/null` to find the location of the `libcassandra` library.
3. Add `export LIBRARY_PATH=/opt/homebrew/lib:$LIBRARY_PATH` to your shell profile.